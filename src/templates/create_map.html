<!DOCTYPE html>
<html>
  <head>
    <title>Aktionskarten</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>

    <!-- Leaflet.Draw -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@0.4.12/dist/leaflet.draw.css" integrity="sha256-XzD3RpaHPv7lzX9qt+2n1j5cWj48O24KsgaGYpKN8x8=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet-draw@0.4.12/dist/leaflet.draw.js" integrity="sha256-gI2Y6ySMCz83g+AlqL24REslHKBuw73jaYfsZb5C3Ac=" crossorigin=""></script>

    <!-- Helper functions for HTTP-Request and other stuff -->
    <script src="{{ url_for('static', filename='utils.js') }}"></script>

    <style>
      html, body, #map {
        width: 100%;
        height: 100%;
        margin: 0;
      }
    </style>
  </head>

  <body>
    <div id='map'></div>

    <script>
      var map = L.map('map', {
                  maxBoundsViscosity: 1.0,
                  zoomSnap: 0.8,
                }).setView([52.4991, 13.4181], 12),
          url = 'http://localhost:5000/',
          apiUrl = url + 'api/maps/';

      // add Leaflet.Draw
      map.addControl(new L.Control.Draw({
            draw: {
              polyline: false,
              polygon: false,
              circle: false,
              marker: false,
              circlemarker: false
            },
            edit: false
      }));

      // add tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        detectRetina: true,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
          '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> '
      }).addTo(map);

      // events
      //
      map.on(L.Draw.Event.CREATED, function (e) {
        var bounds = e.layer.getBounds();
        var bbox = L.GeoJSON.latLngsToCoords([bounds.getSouthEast(), bounds.getNorthWest()]);
        var data = {
          name: '{{map_id}}',
          bbox: [].concat.apply([], bbox)
        };
        window.data=data;
        try {
          post(apiUrl, data).then(function(){
            location.reload();
          });
        }
        catch {
          location.reload();
        }
      });
    </script>
  </body>
</html>
